<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Employee Management System</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f0f2f5;
      }
      h1 {
        text-align: center;
        color: #333;
      }
      .form-container {
        width: 50%;
        margin: 20px auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      form {
        display: flex;
        flex-direction: column;
      }
      input {
        padding: 12px;
        margin: 8px 0;
        border-radius: 6px;
        border: 1px solid #ddd;
        font-size: 14px;
      }
      button {
        padding: 12px 16px;
        margin-top: 15px;
        border: none;
        background-color: #28a745;
        color: white;
        cursor: pointer;
        border-radius: 6px;
        font-size: 14px;
        transition: background-color 0.3s;
      }
      button:hover {
        background-color: #218838;
      }
      button:disabled {
        background-color: #6c757d;
        cursor: not-allowed;
      }
      .error-message {
        color: #dc3545;
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        border-radius: 4px;
        padding: 10px;
        margin: 10px 0;
        display: none;
      }
      .success-message {
        color: #155724;
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        border-radius: 4px;
        padding: 10px;
        margin: 10px 0;
        display: none;
      }
      table {
        width: 90%;
        margin: 30px auto;
        border-collapse: collapse;
        background-color: #fff;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        overflow: hidden;
      }
      th,
      td {
        padding: 15px;
        border: 1px solid #e9ecef;
        text-align: left;
      }
      th {
        background-color: #007bff;
        color: white;
        font-weight: 600;
      }
      tr:nth-child(even) {
        background-color: #f8f9fa;
      }
      tr:hover {
        background-color: #e9ecef;
      }
      .loading {
        text-align: center;
        padding: 20px;
        color: #6c757d;
      }
      .no-data {
        text-align: center;
        padding: 20px;
        color: #6c757d;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <h1>Employee Management System</h1>

    <div class="form-container">
      <form id="employeeForm">
        <div id="errorMessage" class="error-message"></div>
        <div id="successMessage" class="success-message"></div>

        <input
          type="text"
          id="Employee_Name"
          placeholder="Employee Name"
          required
        />
        <input type="email" id="Employee_Email" placeholder="E-mail" required />
        <input
          type="text"
          id="Employee_Location"
          placeholder="Location"
          required
        />
        <button type="submit" id="submitBtn">Add Employee</button>
      </form>
    </div>

    <table id="employeeTable">
      <thead>
        <tr>
          <th>Employee ID</th>
          <th>Employee Name</th>
          <th>Email</th>
          <th>Location</th>
        </tr>
      </thead>
      <tbody id="employeeTableBody">
        <tr>
          <td colspan="4" class="loading">Loading employees...</td>
        </tr>
      </tbody>
    </table>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("employeeForm");
        const tableBody = document.getElementById("employeeTableBody");
        const submitBtn = document.getElementById("submitBtn");
        const errorMessage = document.getElementById("errorMessage");
        const successMessage = document.getElementById("successMessage");

        // Configure your backend URL here
        const baseUrl = "http://localhost:8080";

        // Utility functions
        function showError(message) {
          errorMessage.textContent = message;
          errorMessage.style.display = "block";
          successMessage.style.display = "none";
        }

        function showSuccess(message) {
          successMessage.textContent = message;
          successMessage.style.display = "block";
          errorMessage.style.display = "none";
        }

        function hideMessages() {
          errorMessage.style.display = "none";
          successMessage.style.display = "none";
        }

        function setLoading(loading) {
          submitBtn.disabled = loading;
          submitBtn.textContent = loading ? "Adding..." : "Add Employee";
        }

        // Load existing employees
        function loadEmployees() {
          fetch(`${baseUrl}/displayAll`)
            .then((response) => {
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              return response.json();
            })
            .then((data) => {
              tableBody.innerHTML = "";
              if (data.length === 0) {
                tableBody.innerHTML =
                  '<tr><td colspan="4" class="no-data">No employees found</td></tr>';
                return;
              }

              data.forEach((emp) => {
                const row = tableBody.insertRow();
                row.insertCell(0).innerText = emp.employee_ID;
                row.insertCell(1).innerText = emp.employee_Name;
                row.insertCell(2).innerText = emp.employee_Email;
                row.insertCell(3).innerText = emp.employee_Location;
              });
            })
            .catch((err) => {
              console.error("Error loading employees:", err);
              tableBody.innerHTML =
                '<tr><td colspan="4" class="error-message" style="display: table-cell;">Failed to load employees. Please check your connection.</td></tr>';
            });
        }

        // Initial load
        loadEmployees();

        // Add new employee
        form.addEventListener("submit", function (event) {
          event.preventDefault();
          hideMessages();
          setLoading(true);

          const employeeData = {
            employee_Name: document
              .getElementById("Employee_Name")
              .value.trim(),
            employee_Email: document
              .getElementById("Employee_Email")
              .value.trim(),
            employee_Location: document
              .getElementById("Employee_Location")
              .value.trim(),
          };

          // Client-side validation
          if (!employeeData.employee_Name) {
            showError("Employee name is required");
            setLoading(false);
            return;
          }

          if (!employeeData.employee_Email) {
            showError("Email is required");
            setLoading(false);
            return;
          }

          if (!employeeData.employee_Location) {
            showError("Location is required");
            setLoading(false);
            return;
          }

          fetch(`${baseUrl}/create`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Accept: "application/json",
            },
            body: JSON.stringify(employeeData),
          })
            .then((response) => {
              if (!response.ok) {
                if (response.status === 400) {
                  throw new Error(
                    "Invalid employee data. Please check your inputs."
                  );
                } else if (response.status === 500) {
                  throw new Error("Server error. Please try again later.");
                } else {
                  throw new Error(`HTTP error! status: ${response.status}`);
                }
              }
              return response.json();
            })
            .then((emp) => {
              // Add to table
              const row = tableBody.insertRow();
              row.insertCell(0).innerText = emp.employee_ID;
              row.insertCell(1).innerText = emp.employee_Name;
              row.insertCell(2).innerText = emp.employee_Email;
              row.insertCell(3).innerText = emp.employee_Location;

              // Remove "no data" message if it exists
              const noDataRow = tableBody.querySelector(".no-data");
              if (noDataRow) {
                noDataRow.parentElement.remove();
              }
            })
            .catch((err) => {
              console.error("Error adding employee:", err);
              showError(
                err.message || "Failed to add employee. Please try again."
              );
            })
            .finally(() => {
              setLoading(false);
            });
        });
      });
    </script>
  </body>
</html>